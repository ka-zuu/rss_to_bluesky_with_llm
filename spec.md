# Bluesky RSS自動投稿スクリプト仕様書

## 1. 概要
このスクリプトは、RSSフィードの更新情報を自動で取得し、Gemini APIを使って要約・重要度を評価した上で、Blueskyに投稿するものです。自宅のUbuntuサーバーでの実行を前提とします。

## 2. システム要件
- **OS:** Ubuntu Server
- **プログラミング言語:** Python 3.x
- **ライブラリ:** `feedparser`, `google-generativeai`, `atproto`, `sqlite3`
- **外部サービス:**
    - Gemini APIキー
    - Blueskyアカウント情報（ハンドル名、アプリパスワード）

## 3. 処理フロー
1.  **定期実行:** cronジョブを利用し、ユーザーが設定した間隔（デフォルトは3時間ごと）でスクリプトが実行されます。
2.  **データベースの確認:** ローカルのSQLiteデータベース（`rss_cache.db`）に接続します。このデータベースは、重複投稿を防ぐため、既に処理済みの記事のURLを保存するために使用します。
3.  **RSSフィードの取得:**
    - 事前に定義されたRSSフィードURLのリストを順に処理します。
    - 各フィードから最新の記事を取得します。
    - 取得した記事とデータベースを比較し、まだ投稿されていない新しい記事のみを抽出します。新しい記事がない場合は、スクリプトを終了します。
4.  **Gemini API処理（記事の重要度評価）：**
    - 新しい記事のタイトルとURLをGemini APIに送信します。
    - 「重要度が高い順に記事をリスト化して」と指示し、AIに記事のランキングを生成させます。
5.  **Blueskyへの投稿（スレッド作成-パート1）：**
    - ランク付けされた記事リストを含む新しいBluesky投稿を作成します。これがスレッドの親投稿となります。
6.  **Gemini API処理（記事の要約）：**
    - ランク付けされた記事の中から、特に重要度の高いものをいくつか選択します。
    - 選択した各記事の全文を取得します。
    - 各記事の内容をGemini APIに送信し、「この記事を3文で要約して」といった指示で簡潔な要約を生成させます。
7.  **Blueskyへの投稿（スレッド作成-パート2）：**
    - 要約が生成された各記事について、要約文を含む新しいBluesky投稿を作成します。
    - これらの投稿を親投稿へのリプライとして投稿し、完全なスレッドを形成します。
8.  **データベースの更新:** 投稿成功後、処理した新しい記事のURLを`rss_cache.db`に保存し、処理済みとして記録します。

## 4. 主要な関数/モジュール
- `main.py`: 全体の処理を調整するメインスクリプトです。
- `rss_fetcher.py`: RSSフィードの取得と解析を担うモジュールです。
- `gemini_processor.py`: 重要度評価と要約の両方でGemini APIと連携するためのモジュールです。
- `bluesky_poster.py`: Blueskyの認証と投稿処理を担うモジュールです。
- `db_manager.py`: SQLiteデータベースの管理（記事データの保存と照会）を担うモジュールです。

## 5. cronジョブの例
スクリプトを3時間ごとに実行する場合の例：
`0 */3 * * * /path/to/your/script/venv/bin/python /path/to/your/script/main.py`
